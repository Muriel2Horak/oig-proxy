{
  "uid": "oig-fleet-influx",
  "title": "OIG Fleet Overview",
  "tags": ["oig", "telemetry"],
  "timezone": "browser",
  "refresh": "30s",
  "time": {"from": "now-6h", "to": "now"},
  "panels": [
    {
      "id": 1,
      "title": "Total Devices",
      "type": "stat",
      "gridPos": {"h": 4, "w": 4, "x": 0, "y": 0},
      "datasource": {"type": "influxdb", "uid": "afc1e5763y6f4d"},
      "targets": [{
        "refId": "A",
        "query": "from(bucket: \"telemetry\")\n  |> range(start: -10m)\n  |> filter(fn: (r) => r._field == \"uptime_s\")\n  |> last()\n  |> group()\n  |> count()"
      }],
      "fieldConfig": {
        "defaults": {
          "color": {"mode": "thresholds"},
          "thresholds": {"steps": [{"color": "blue", "value": null}]}
        }
      },
      "options": {"colorMode": "value", "graphMode": "none", "justifyMode": "center", "textMode": "value"}
    },
    {
      "id": 5,
      "title": "BOX Disconnected",
      "type": "stat",
      "gridPos": {"h": 4, "w": 4, "x": 4, "y": 0},
      "datasource": {"type": "influxdb", "uid": "afc1e5763y6f4d"},
      "targets": [{
        "refId": "A",
        "query": "from(bucket: \"telemetry\")\n  |> range(start: -10m)\n  |> filter(fn: (r) => r._field == \"box_connected\")\n  |> last()\n  |> filter(fn: (r) => r._value == false)\n  |> group()\n  |> count()"
      }],
      "fieldConfig": {
        "defaults": {
          "color": {"mode": "thresholds"},
          "thresholds": {"steps": [{"color": "green", "value": null}, {"color": "red", "value": 1}]},
          "noValue": "0"
        }
      },
      "options": {"colorMode": "value", "graphMode": "none", "justifyMode": "center", "textMode": "value"}
    },
    {
      "id": 6,
      "title": "Cloud Offline",
      "type": "stat",
      "gridPos": {"h": 4, "w": 4, "x": 8, "y": 0},
      "datasource": {"type": "influxdb", "uid": "afc1e5763y6f4d"},
      "targets": [{
        "refId": "A",
        "query": "from(bucket: \"telemetry\")\n  |> range(start: -10m)\n  |> filter(fn: (r) => r._field == \"cloud_online\")\n  |> last()\n  |> filter(fn: (r) => r._value == false)\n  |> group()\n  |> count()"
      }],
      "fieldConfig": {
        "defaults": {
          "color": {"mode": "thresholds"},
          "thresholds": {"steps": [{"color": "green", "value": null}, {"color": "orange", "value": 1}]},
          "noValue": "0"
        }
      },
      "options": {"colorMode": "value", "graphMode": "none", "justifyMode": "center", "textMode": "value"}
    },
    {
      "id": 7,
      "title": "Total Errors",
      "type": "stat",
      "gridPos": {"h": 4, "w": 4, "x": 12, "y": 0},
      "datasource": {"type": "influxdb", "uid": "afc1e5763y6f4d"},
      "targets": [{
        "refId": "A",
        "query": "from(bucket: \"telemetry\")\n  |> range(start: -10m)\n  |> filter(fn: (r) => r._field == \"cloud_errors\")\n  |> last()\n  |> group()\n  |> sum()"
      }],
      "fieldConfig": {
        "defaults": {
          "color": {"mode": "thresholds"},
          "thresholds": {"steps": [{"color": "green", "value": null}, {"color": "yellow", "value": 1}, {"color": "red", "value": 10}]},
          "noValue": "0"
        }
      },
      "options": {"colorMode": "value", "graphMode": "none", "justifyMode": "center", "textMode": "value"}
    },
    {
      "id": 8,
      "title": "Total Frames RX",
      "type": "stat",
      "gridPos": {"h": 4, "w": 4, "x": 16, "y": 0},
      "datasource": {"type": "influxdb", "uid": "afc1e5763y6f4d"},
      "targets": [{
        "refId": "A",
        "query": "from(bucket: \"telemetry\")\n  |> range(start: -10m)\n  |> filter(fn: (r) => r._field == \"frames_received\")\n  |> last()\n  |> group()\n  |> sum()"
      }],
      "fieldConfig": {
        "defaults": {
          "color": {"mode": "thresholds"},
          "thresholds": {"steps": [{"color": "green", "value": null}]},
          "noValue": "0"
        }
      },
      "options": {"colorMode": "value", "graphMode": "none", "justifyMode": "center", "textMode": "value"}
    },
    {
      "id": 9,
      "title": "Avg Uptime",
      "type": "stat",
      "gridPos": {"h": 4, "w": 4, "x": 20, "y": 0},
      "datasource": {"type": "influxdb", "uid": "afc1e5763y6f4d"},
      "targets": [{
        "refId": "A",
        "query": "from(bucket: \"telemetry\")\n  |> range(start: -10m)\n  |> filter(fn: (r) => r._field == \"uptime_s\")\n  |> last()\n  |> group()\n  |> mean()"
      }],
      "fieldConfig": {
        "defaults": {
          "color": {"mode": "thresholds"},
          "thresholds": {"steps": [{"color": "blue", "value": null}]},
          "unit": "dtdurations",
          "noValue": "0"
        }
      },
      "options": {"colorMode": "value", "graphMode": "none", "justifyMode": "center", "textMode": "value"}
    },
    {
      "id": 2,
      "title": "Device List",
      "description": "Click Device ID to open detail",
      "type": "table",
      "gridPos": {"h": 12, "w": 24, "x": 0, "y": 4},
      "datasource": {"type": "influxdb", "uid": "afc1e5763y6f4d"},
      "targets": [{
        "refId": "A",
        "query": "from(bucket: \"telemetry\")\n  |> range(start: -10m)\n  |> filter(fn: (r) => r._field == \"uptime_s\" or r._field == \"box_connected\" or r._field == \"cloud_online\" or r._field == \"cloud_errors\" or r._field == \"frames_received\")\n  |> last()\n  |> pivot(rowKey: [\"device_id\"], columnKey: [\"_field\"], valueColumn: \"_value\")\n  |> group()\n  |> keep(columns: [\"device_id\", \"version\", \"mode\", \"box_connected\", \"cloud_online\", \"uptime_s\", \"cloud_errors\", \"frames_received\"])\n  |> sort(columns: [\"device_id\"])"
      }],
      "fieldConfig": {
        "defaults": {},
        "overrides": [
          {
            "matcher": {"id": "byName", "options": "device_id"},
            "properties": [
              {"id": "displayName", "value": "Device ID"},
              {"id": "links", "value": [{"title": "Open Detail", "url": "/d/oig-box-influx?var-device_id=${__value.text}"}]},
              {"id": "custom.width", "value": 130},
              {"id": "custom.cellOptions", "value": {"type": "color-text"}},
              {"id": "color", "value": {"mode": "fixed", "fixedColor": "text"}}
            ]
          },
          {
            "matcher": {"id": "byName", "options": "version"},
            "properties": [{"id": "displayName", "value": "Version"}, {"id": "custom.width", "value": 80}]
          },
          {
            "matcher": {"id": "byName", "options": "mode"},
            "properties": [
              {"id": "displayName", "value": "Mode"},
              {"id": "custom.width", "value": 90},
              {"id": "custom.cellOptions", "value": {"type": "color-background", "mode": "basic"}},
              {"id": "mappings", "value": [{"type": "value", "options": {"online": {"text": "ONLINE", "color": "dark-green"}, "local": {"text": "LOCAL", "color": "dark-yellow"}}}]}
            ]
          },
          {
            "matcher": {"id": "byName", "options": "box_connected"},
            "properties": [
              {"id": "displayName", "value": "BOX"},
              {"id": "custom.width", "value": 110},
              {"id": "custom.cellOptions", "value": {"type": "color-background", "mode": "basic"}},
              {"id": "mappings", "value": [{"type": "value", "options": {"true": {"text": "Connected", "color": "dark-green"}, "false": {"text": "Disconnected", "color": "dark-red"}}}]}
            ]
          },
          {
            "matcher": {"id": "byName", "options": "cloud_online"},
            "properties": [
              {"id": "displayName", "value": "Cloud"},
              {"id": "custom.width", "value": 90},
              {"id": "custom.cellOptions", "value": {"type": "color-background", "mode": "basic"}},
              {"id": "mappings", "value": [{"type": "value", "options": {"true": {"text": "Online", "color": "dark-green"}, "false": {"text": "Offline", "color": "dark-orange"}}}]}
            ]
          },
          {
            "matcher": {"id": "byName", "options": "uptime_s"},
            "properties": [{"id": "displayName", "value": "Uptime"}, {"id": "unit", "value": "dtdurations"}, {"id": "custom.width", "value": 120}]
          },
          {
            "matcher": {"id": "byName", "options": "cloud_errors"},
            "properties": [
              {"id": "displayName", "value": "Errors"},
              {"id": "custom.width", "value": 80},
              {"id": "custom.cellOptions", "value": {"type": "color-text"}},
              {"id": "thresholds", "value": {"mode": "absolute", "steps": [{"color": "green", "value": null}, {"color": "yellow", "value": 1}, {"color": "red", "value": 10}]}},
              {"id": "color", "value": {"mode": "thresholds"}}
            ]
          },
          {
            "matcher": {"id": "byName", "options": "frames_received"},
            "properties": [{"id": "displayName", "value": "Frames RX"}, {"id": "custom.width", "value": 100}]
          }
        ]
      },
      "options": {"showHeader": true, "cellHeight": "sm", "footer": {"show": true, "countRows": true, "reducer": ["sum"], "fields": ["cloud_errors", "frames_received"]}}
    }
  ],
  "schemaVersion": 39
}
